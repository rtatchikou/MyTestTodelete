package com.multipart.multipart;


import java.io.File;
import java.util.Arrays;
import java.util.HashMap;
import java.util.Map;
import java.util.UUID;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.openfeign.EnableFeignClients;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.client.RestTemplate;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.multipart.multipart.request.Credentials;
import com.multipart.multipart.request.GetPolicyListRequest;
import com.multipart.multipart.request.GetPolicyListUserInputSettings;
import com.multipart.multipart.request.response.GetPolicyListResponse;
import com.multipart.multipart.utils.CsvUtils;
import com.multipart.multipart.utils.JsonUtils;

@SpringBootApplication
@EnableFeignClients
public class MultipartApplication implements CommandLineRunner {

	public static void main(String[] args) {
		SpringApplication.run(MultipartApplication.class, args);
	}
	
	@Autowired
	ExpensifyClient expensifyClient;

	@Override
	public void run(String... args) throws Exception {
		
		  ObjectMapper mapper = new ObjectMapper();
				  
		

        Credentials credentials = new Credentials("aa_raymondtatchikou_lyncwork_com","7e1b956a1ebd939dc72774688773cd7c0bcf5b90" );
        InputSettings inputSettings = new InputSettings("employees", "EFE13365F26F238C", "csv");
        ProvisionUserRequest writeValueAsString = new ProvisionUserRequest("update", credentials, inputSettings);

        String filePath = "/Users/traymond/Documents/0-LYNCWORK/EXPENSIFY-GIT-INIT/"+UUID.randomUUID().toString()+"employeeData.csv";
        File csvFile = CsvUtils.createEmployeeDataCsv(filePath,"varindersingh@lyncwork.com", "raymondtatchikou@lyncwork.com", true);
        
        String provision = "requestJobDescription="+JsonUtils.writeValueAsString(writeValueAsString);
        
        GetPolicyListUserInputSettings policyInputSettings = new GetPolicyListUserInputSettings("policyList", false, "raymondtatchikou@lyncwork.com");
        GetPolicyListRequest getPolicyListRequest = new GetPolicyListRequest("get", credentials, policyInputSettings);

        String getPolicyListBody = "requestJobDescription="+JsonUtils.writeValueAsString(getPolicyListRequest);
        
       
        
        
       // GetPolicyListResponse policyList = expensifyClient.getPolicyList(getPolicyListBody);

       // System.out.println(expensifyClient.getPolicyList(getPolicyListBody));
		
		System.out.println(mapper.writeValueAsString(writeValueAsString) );
		
		RestTemplate restTemplate = new RestTemplate();
		HttpHeaders headers = new HttpHeaders();
	      headers.setAccept(Arrays.asList(MediaType.APPLICATION_JSON));
	      headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);
	      HttpEntity<String> entity = new HttpEntity<String>(getPolicyListBody,headers);
	      
	      System.out.println(restTemplate.exchange(
	         "https://integrations.expensify.com//Integration-Server/ExpensifyIntegrations", HttpMethod.POST, entity, String.class).getBody());
	      
	      
	      
	      
	      String provisionBody = "requestJobDescription="+JsonUtils.writeValueAsString(writeValueAsString)+" data=@"+csvFile.getAbsolutePath();
	      

	      System.out.println("$$$$$$--->"+provisionBody);
	        
	      
	      
	      Map<String, Object> body2 = new HashMap<>();
	      body2.put("requestJobDescription", JsonUtils.writeValueAsString(writeValueAsString));
	      body2.put("data", csvFile.getAbsolutePath());
	      
	      HttpHeaders headers2 = new HttpHeaders();
	      headers2.setAccept(Arrays.asList(MediaType.APPLICATION_JSON));
	      headers2.setContentType(MediaType.APPLICATION_FORM_URLENCODED);
	      HttpEntity<String> entity2 = new HttpEntity<String>(provisionBody,headers);
	      
	      System.out.println(csvFile.getAbsolutePath());
	      
	      System.out.println(restTemplate.exchange(
	         "https://integrations.expensify.com//Integration-Server/ExpensifyIntegrations", HttpMethod.POST, entity2, String.class).getBody());
	      
	      
	      
	   

		//HttpEntity<String> request = new HttpEntity<>(new String());
		
		//restTemplate.postForObject("https://integrations.expensify.com/Integration-Server/ExpensifyIntegrations", request, String.class);
	}

}
